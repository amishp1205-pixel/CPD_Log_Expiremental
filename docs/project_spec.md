# Project Spec: CPD Log Project

---

## 1. Project Goal

**Goal statement:**
To create a web-based continuing professional development (CPD) log for UK pharmacists and level 3 dispensing technicians that makes creating and viewing CPD entries significantly faster and less effortful than the current manual process.

**What does success look like?**
A user can complete a CPD entry in roughly half the time it currently takes to write one manually, by answering a short set of questions and receiving a GPhC-compliant CPD entry generated by AI.

---

## 2. Milestones

### MVP (Milestone 1)

- Feature: Guided learning entry form — user selects learning type (planned or unplanned) and answers a set of questions tailored to that type.
- Feature: AI-generated CPD entry — converts the user's answers into a CPD entry that meets GPhC standards and guidance, using provided example entries as a reference.
- Feature: Editable output — the generated CPD entry is displayed in an editable text area so the user can refine it before downloading.
- Feature: Download — the user can download the final CPD entry as a plain text (.txt) file.

**Out of MVP scope:**
User registration, login, authentication, payment, persistent storage of entries, and entry history.

### Version 2 (Milestone 2)

- Feature: User registration and authentication (including Google sign-in) and payment.
- Feature: Persistent CPD entry log — saved entries are stored and viewable by the authenticated user over time.

### Future Versions

- Duplicate / similarity check — flag entries that are too similar to previous ones to encourage varied learning.
- Progress tracking — monitor whether the required number of CPD entries has been completed and alert the user if not.
- Resources section — curated links and materials to support learning.
- Date-range export — allow the user to print or download CPD entries filtered by a date range.
- Practice area categories — tag entries by practice area (e.g. Community Pharmacy, Primary Care Pharmacy, Management & Leadership).
- Dashboard — display summary stats: entries completed this year, entries pending, and a breakdown by category.

---

## 3. Product Requirements

### Who is this for?

**Target users:**
UK registered pharmacists and level 3 dispensing technicians.

**User context:**
Whenever a pharmacist or level 3 dispensing technician undertakes a learning activity — planned or unplanned — they use this application to create a CPD entry for it.

### What problems does it solve?

1. It takes significant time to structure a learning activity into a compliant CPD entry.
2. The manual CPD writing process adds friction to what should be a positive experience (learning).
3. No existing application automates this specific task for these professionals.

### What should the product do?

#### User Flow — Step by Step

**Step 1 — Landing page**
The main page displays a prominent "Record Learning" button.

**Step 2 — Select learning type**
On selecting "Record Learning", the user is presented with a choice:
- **Planned learning** — a learning activity the user intentionally planned and sought out.
- **Unplanned learning** — a learning activity that arose unexpectedly (e.g. from a clinical incident or patient query).

**Step 3 — Learning entry form**
A form titled "Learning Entry" is displayed with questions tailored to the selected learning type, followed by a Submit button.

**Planned learning questions:**
1. What did you learn?
2. How did you plan this learning? Include any training sources you used.
3. What topics and areas did the learning cover?
4. How will you apply this learning in practice?
5. Have you already applied it? If so, give examples of how.
6. What are the key benefits to service users from your learning?
7. How do you feel the service you offer has been enhanced by your learning?

**Unplanned learning questions:**
1. What did you learn?
2. Describe how this learning came about — what triggered or prompted it?
3. What topics and areas did the learning cover?
4. How will you apply this learning in practice?
5. Have you already applied it? If so, give examples of how.
6. What are the key benefits to service users from your learning?
7. How do you feel the service you offer has been enhanced by your learning?

> Note: Questions 1, 3–7 are shared across both types. Question 2 differs: planned learning asks about intentional planning and sources; unplanned learning asks about the trigger or context.

**Step 4 — AI generates CPD entry**
On submitting the form:
- The answers are sent to the backend, which calls the Anthropic Claude API.
- The AI prompt includes the user's answers, the learning type, and the contents of the reference CPD example files to guide formatting and tone.
- A GPhC-compliant CPD entry is generated and returned.

**Step 5 — Review and edit**
The generated CPD entry is displayed in an editable text area. The user can make any changes they want.

**Step 6 — Download**
A "Download" button saves the final entry as a plain text (.txt) file.

---

## 4. Technical Requirements

### Tech Stack

| Layer | Technology | Rationale |
|---|---|---|
| Hosting | Replit | Required by project constraints. Supports full-stack Node.js apps. |
| Frontend | React | Component-friendly for the multi-step form and editable output flow. Strong Replit support. |
| Backend | Node.js + Express | Lightweight server to proxy AI API calls. Keeps the Anthropic API key server-side and out of the browser. |
| AI / LLM | Anthropic Claude API | Selected for strong instruction-following and structured output generation. Well suited to producing consistently formatted CPD entries. |
| Database | None (MVP) | No user accounts or persistent storage in the MVP. Entries are generated, edited, and downloaded within a single session. |
| State (optional) | Browser localStorage | Can preserve form draft state if the user navigates away mid-session, without requiring a database. |
| Unit Testing | Jest | Tests individual functions in isolation: prompt assembly, form validation, download helper, and API route handler. |
| E2E Testing | Playwright + Playwright MCP | End-to-end browser tests for full user flows. Playwright MCP allows Claude to interact with the running app in a real browser during development for verification and debugging. |

### Technical Architecture

**System overview:**
A single-page React application served by an Express server on Replit. The user interacts entirely with the React frontend. When the user submits their learning entry, the frontend sends the form data to an Express API endpoint. The Express server assembles the AI prompt (user answers + learning type + reference CPD examples), calls the Anthropic Claude API, and returns the generated CPD entry to the frontend for display and editing.

**Key components:**

1. **React Frontend** — Renders the landing page, learning type selector, the conditional question form, the editable CPD output, and the download button. Manages local form state.
2. **Express Backend / API Proxy** — Receives the form submission, constructs the prompt with the reference examples, calls the Anthropic Claude API securely (API key is server-side only), and returns the generated CPD text.
3. **Reference CPD Examples** — A set of plain-text files (converted from the source PDFs in `cpd examples/`) stored in the project. Loaded by the backend at request time and injected into the AI prompt as few-shot examples of good CPD entries.

**Database schema:**
Not applicable for MVP. No database is provisioned. If localStorage is used for draft preservation, it is client-side only and contains no persistent user data.

**API design:**

| Method | Endpoint | Purpose |
|---|---|---|
| POST | `/api/generate-cpd` | Receives learning type and user answers. Calls Anthropic Claude API with the prompt and reference examples. Returns the generated CPD entry as plain text. |

Request body:
```json
{
  "learningType": "planned" or "unplanned",
  "answers": {
    "q1": "...",
    "q2": "...",
    "q3": "...",
    "q4": "...",
    "q5": "...",
    "q6": "...",
    "q7": "..."
  }
}
```

Response body:
```json
{
  "cpdEntry": "Generated CPD entry text..."
}
```

### Infrastructure to Provision

Before building, set up the following:

- [x] Hosting environment — Replit workspace (create a new Node.js project)
- [ ] API key — Anthropic API key (add as a Replit Secret, not hardcoded)
- [ ] Reference examples — Convert the PDFs in `cpd examples/` to plain text files and place them in the project (e.g. `server/examples/`)
- [ ] Domain name — Optional. Replit provides a `.replit.dev` URL by default.
- [ ] Playwright — Run `npx playwright install` to download browsers before running E2E tests.

---

## 5. Testing Strategy

Testing is organised into three layers. Together, the unit and E2E suites form the regression suite and should be run before every commit.

### 5.1 Unit Tests — Jest

Tests individual functions in isolation. No browser or running server required.

| Area | What is tested |
|---|---|
| Prompt assembly | Given a learning type and a set of answers, the function that builds the Anthropic API prompt returns the correct string — correct question labels, reference examples injected, and learning type noted. |
| Form validation | All 7 fields are required. Submitting with any field empty is blocked client-side; the API is never called with incomplete data. |
| Download helper | The function that triggers a browser .txt download receives the correct text content and filename. |
| API route handler | The Express `/api/generate-cpd` route correctly forwards the request to Anthropic and returns the parsed response. Tested with a mocked Anthropic client — no real API calls during unit tests. |

**Run:** `npm test`

### 5.2 End-to-End Tests — Playwright + Playwright MCP

Tests the full application in a real browser. Catches issues that unit tests miss: component wiring, UI state transitions, and real network behaviour.

| Test scenario | What is asserted |
|---|---|
| Planned learning happy path | User clicks "Record Learning" → selects Planned → fills all 7 questions → submits → loading state appears → CPD entry is displayed → entry is editable → download produces a valid .txt file. |
| Unplanned learning happy path | Same flow as above but with Unplanned selected. Q2 text and placeholder differ from the Planned flow. |
| Learning type switcher | Selecting Planned vs Unplanned updates Q2 in the form. The other 6 questions remain unchanged. |
| Loading state | A visible loading indicator appears immediately on submit and disappears once the response is rendered. The Submit button is disabled during loading. |
| Empty form blocked | Submitting the form with one or more fields empty does not trigger an API call; a validation message is shown. |
| API key not leaked | A Playwright network intercept confirms that no request from the browser contains the Anthropic API key. |

**Playwright MCP** is used during development to let Claude interact with the running app in a real browser — navigating pages, clicking elements, reading text, and taking screenshots — for ad-hoc verification and debugging without writing a formal test script.

**Run:** `npx playwright test` (headless) or `npx playwright test --ui` (interactive)

### 5.3 Regression Suite

The Jest unit suite and the Playwright E2E suite together constitute the regression suite. Run both before every commit, and at minimum after any change to:

- Form logic or question sets
- Prompt assembly or API route
- Download functionality
- UI state transitions (loading, validation)

If either suite fails, the commit should not proceed until the failure is resolved or explicitly understood.

---

## 6. Non-Functional Requirements

- **Security** — The Anthropic API key must never be exposed to the browser. All AI calls go through the Express backend.
- **Responsiveness** — The form and output should work well on both desktop and mobile browsers.
- **UI style** — Professional looking. Clean layout with clear visual hierarchy, appropriate use of whitespace, and a polished feel. Not heavily branded, but not bare-bones either.
- **Performance** — The AI generation step will have latency (typically a few seconds). The UI should show a loading state while waiting.

---

## 7. Out of Scope

The following are explicitly not part of the MVP or near-term roadmap unless noted in Future Versions:

- E-commerce / payment processing (deferred to Milestone 2)
- User registration, login, or authentication (deferred to Milestone 2)
- Persistent storage of CPD entries or user data (deferred to Milestone 2)
- Mobile native application
- Direct integration with the GPhC systems or portals
- Multi-language support
- Offline / no-internet-connection mode
- Automated validation of CPD entries against GPhC rules (AI generates best-effort output; user reviews and edits)

---

## 8. Open Items / Pre-Build Tasks

These must be resolved before development begins:

1. **Convert reference PDFs to plain text** — The 6 PDF files in `cpd examples/` (3 planned, 3 unplanned, across Community Pharmacy, Management & Leadership, Primary Care Pharmacy) need to be converted to `.txt` and placed in the project for the AI prompt.
2. **Obtain Anthropic API key** — Required for the Claude API calls. Store as a Replit Secret.

---

## Summary

| Item | Detail |
|---|---|
| One-liner | AI-powered tool to generate GPhC-compliant CPD entries from a short learning questionnaire |
| MVP scope | Guided learning entry form (planned & unplanned) → AI-generated CPD entry → edit → download as .txt |
| Tech stack | React + Node.js/Express on Replit, Anthropic Claude API |
| First milestone "done" looks like | A user can answer questions about a learning activity, receive a CPD entry that meets GPhC standards, edit it, and download it — with no login or account required |

---

> **Next step:** Once this spec is finalised, proceed to create `CLAUDE.md` to configure Claude Code for the project (see [create_claudemd.md](../create_claudemd.md)).
